package bookshop.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import bookshop.code.DAOoperations;

@Controller
public class SearchController
{
	private DAOoperations dao = new DAOoperations();
	
	@RequestMapping(value = "/search", method = RequestMethod.GET)
	   public ModelAndView searchPage()
	   {
	      ModelAndView mav = new ModelAndView("search");
	      return mav;
	   }

	   @RequestMapping(value = "/doSearch", method = RequestMethod.POST)
	   public ModelAndView search(
	      @RequestParam("searchText")
	      String searchText
	   ) throws Exception
	   {
	      List<Book> allFound = _repo.searchForBook(searchText);
	      List<BookModel> bookModels = new ArrayList<BookModel>();
	      
	      for (Book b : allFound)
	      {
	         BookModel bm = new BookModel();
	         bm.setBookAuthor(b.getAuthor());
	         bm.setBookDescription(b.getDescription());
	         bm.setBookTitle(b.getTitle());
	         
	         bookModels.add(bm);
	      }
	      
	      ModelAndView mav = new ModelAndView("foundBooks");
	      mav.addObject("foundBooks", bookModels);
	      return mav;
	   }
}
